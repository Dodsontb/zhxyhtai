<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Dashboard</title>
        <!-- Mobile specific metas -->
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <!-- Force IE9 to render in normal mode -->
        <!--[if IE]><meta http-equiv="x-ua-compatible" content="IE=9" /><![endif]-->
        <meta name="author" content="SuggeElson" />
        <meta name="description" content=""
        />
        <meta name="keywords" content=""
        />
        <meta name="application-name" content="sprFlat admin template" />
        <!-- Import google fonts - Heading first/ text second -->
        <link rel='stylesheet' type='text/css' 
        <!--[if lt IE 9]>

		<![endif]-->
        <!-- Css files -->
        <!-- Icons -->
        <link href="assets/css/icons.css" rel="stylesheet" />
        <!-- jQueryUI -->
        <link href="assets/css/sprflat-theme/jquery.ui.all.css" rel="stylesheet" />
        <!-- Bootstrap stylesheets (included template modifications) -->
        <link href="assets/css/bootstrap.css" rel="stylesheet" />
        <!-- Plugins stylesheets (all plugin custom css) -->
        <link href="assets/css/plugins.css" rel="stylesheet" />
        <!-- Main stylesheets (template main css file) -->
        <link href="assets/css/main.css" rel="stylesheet" />
        <!-- Custom stylesheets ( Put your own changes here ) -->
        <link href="assets/css/custom.css" rel="stylesheet" />
        <!-- Fav and touch icons -->
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/img/ico/apple-touch-icon-144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/img/ico/apple-touch-icon-114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/img/ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="assets/img/ico/apple-touch-icon-57-precomposed.png">
        <link rel="icon" href="assets/img/ico/favicon.ico" type="image/png">
        <!-- Windows8 touch icon ( http://www.buildmypinnedsite.com/ )-->
        <meta name="msapplication-TileColor" content="#3399cc" />
		<style type="text/css">
			.ljxone{
				margin-bottom: 20px;
			}
			select{
				margin-left: 20px;
			}
		</style>
    </head>
    <body>
       
        <div id="content">
        	<!-- Start .content-wrapper -->
        	<div class="content-wrapper">
        		<div class="row">
        			<!-- Start .row -->
        			<!-- Start .page-header -->
        			<div class="col-lg-12 heading">
        					<h1 class="page-header"><i class="ec-archive"></i> 任务管理</h1>
        					<!-- Start .bredcrumb -->
        					<ul  class="breadcrumb">
        					</ul>
        					<!-- End .breadcrumb -->
        					<!-- Start .option-buttons -->
        					<div class="option-buttons">
        							<div class="btn-toolbar" role="toolbar">
        							</div>
        					</div>
        					<!-- End .option-buttons -->
        			</div>
        			<!-- End .page-header -->
        		</div>
        		<!-- End .row -->
        		<div class="outlet"  id="b">
        			<!-- Start .outlet -->
        			<!-- Page start here -->
        			<div id="email-sidebar">
        				<!-- Start #email-sidebar -->
        				<div class="p15">
        						<a id="write-email"  class="btn btn-danger btn-block uppercase"  data-toggle="modal" data-target="#myModal"><i class="im-quill"></i>发布任务</a>
        						
        				</div>
        				<ul id="sideNav" class="nav nav-pills nav-stacked">
                    <li class="top-search">
                        
                    </li>
                    <li><a href="#">我的任务<i class="im-screen"></i></a>
                    </li>
                    <!--班级管理-->
                    <li><!-- <a href="#"> S1 <i class="im-table2"></i></a> -->
                        <ul class="nav sub" v-for="(t,index) in list">
                            <li v-for="(c,index) in t.list"><a href="#"> {{c.name}}</a>
								<ul class="nav sub">
									<li><a href="#" v-on:click="cpstudent1(c.name)"> 已完成</a>
									</li>
									<li><a href="#" v-on:click="cpstudent2(c.name)"> 未完成</a>
									</li>
									<li><a href="#" v-on:click="cpstudent3(c.name)"> 推迟任务</a>
									</li>
									<li><a href="#" v-on:click="cpstudent4(c.name)"> 任务历史</a>
									</li>
								</ul>
                            </li>
                        </ul>
                    </li>
					
					
                </ul>
        			</div>
        			<!--End #email-sidebar -->
        			<div id="email-content">
        					<!-- Start #email-content -->
        					<div class="email-wrapper">
        						<!-- <select style="width: 150px;">
        							<option value ="">年级</option>
        						</select>
        						<select style="width: 150px;">
        							<option value ="">班级</option>
        						</select>
        						<select style="width: 150px;">
        							<option value ="">日期</option>
        						</select> -->
        							<div class="email-toolbar col-lg-12">
        								<ul class="email-pager">
        									<li class="pager-info"></li>
        									
        								</ul>
        							</div>
        							<div class="email-toolbar-search col-lg-12">
        									<form>
        											<input type="text" class="form-control input-xlarge" name="search" placeholder="根据姓名模糊查">
        									</form>
        							</div>
        							<div class="email-list col-lg-12">
        									<table class="table table-striped table-hover table-fixed-layout non-responsive">
        											<tbody>
        													<tr>
        														<td class="email-select input-mini">
        																姓名
        														</td>
        														<td class="email-star input-mini"><i class="im-star s20"></i>
        														</td>
        														<td class="email-subject">标题
        														</td>
        														<td class="email-intro">
        																日期
        														</td>
        														<td class="email-date text-right input-mini">操作</td>
        													</tr>
        											</tbody>
        									</table>
        									<ul class="one" style="list-style: none; margin-left: -25px;" v-if="yesno==0">
														<li v-for="(c,index) in cpsudentlist">
															<div style="float:left;width:100px;">の</div>
															<div style="float:left;width:200px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;">{{c.ljxtitle}}</div>
															<div style="float:left;width:300px; margin-left: 60px">{{c.ljxdatetime}}</div>
															<div style="float:right;width:40px;" class="see" v-on:click="tuiClick(index)">查看</div>
															<div id="ul01" style="margin-left: -40px;display: none">
																<div v-for="(w,index) in c.list">
																	<a v-for="(s,index) in w.cpstudent">
																		<div style="float:left;width:100px;margin-left: 40px">{{s.studentname}}</div>
																		<div style="float:left;width:200px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;">{{c.ljxtitle}}</div>
																		<div style="float:left;width:300px; margin-left: 60px">{{w.ljxdate}}</div>
																		<div style="float:right;width:50px;margin-left:-10px;">已完成</div>
																	</a>
																</div>
															</div>
														</li>
													</ul>
													<ul class="one" style="list-style: none; margin-left: -25px;" v-if="yesno==1">
														<li v-for="(c,index) in listyn">
															<div style="float:left;width:100px;">の</div>
															<div style="float:left;width:200px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;">{{c.ljxtitle}}</div>
															<div style="float:left;width:200px; margin-left: 60px">{{c.ljxdatetime}}</div>
															<div style="float:right;width:100px;" class="see" v-on:click="tuiClick(index)"v-for="(w,index) in c.list">已：{{w.name5}}，未：{{w.name4}}</div>
														</li>
													</ul>
													<ul class="one" style="list-style: none; margin-left: -25px;" v-if="yesno==2">
														<li v-for="(c,index) in tuichiquery">
															<div style="float:left;width:100px;">の</div>
															<div style="float:left;width:200px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;">{{c.ljxtitle}}</div>
															<div style="float:left;width:300px; margin-left: 60px">{{c.ljxdatetime}}</div>
															<div style="float:right;width:40px;" class="see" v-on:click="tuiClick(index)">查看</div>
															<div id="ul01" style="margin-left: -40px;display: none">
																<div v-for="(w,index) in c.asslist">
																	<a v-for="(s,index) in w.cpslist">
																		<div style="float:left;width:100px;margin-left: 40px">{{s.studentname}}</div>
																		<div style="float:left;width:200px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;">{{c.ljxtitle}}</div>
																		<div style="float:left;width:300px; margin-left: 60px">{{w.ljxTitme}}</div>
																		<div style="float:right;width:50px;margin-left:-10px;" data-toggle="modal" data-target="#mytui" v-if="w.putlist == null" v-on:click="tuix(w.ljxtuid)">  阅读</div>
																		<div style="float:right;width:50px;margin-left:-10px;"  v-for="(p,index) in w.putlist" v-if="p.ljxyesno=='是'" >  已阅/通</div>
																		<div style="float:right;width:50px;margin-left:-10px;" data-toggle="modal" data-target="#mytui" v-for="(p,index) in w.putlist" v-if="p.ljxyesno=='否'" v-on:click="tuix(w.ljxtuid)">  已阅/未</div>
																	</a>
																</div>
															</div>
														</li>
													</ul>
        							</div>
        					</div>
        			</div>
        			<!--End #email-content -->
        			<!-- Page End here -->
        			
        			<!-- Modal -->
					<form th:action="@{/stuinsert}" method="post" >
					<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<h4 class="modal-title" id="myModalLabel">发布任务</h4>
							任务类型：<select v-model="mo" style="width: 100.43px;height: 25.06px; color: black;" id="type" name = "ljxtype">
											<option v-for="(type,index) in typelist" v-bind:value ="type.id">{{type.name}}</option>
										</select>
						</div>
						<div class="modal-body">
								<ul style="list-style: none; margin-left: 100px">
									<li class="ljxone">项目标题：<input type="text" name="ljxtitle" class="ljxtitle"></li>
									<li class="ljxone">项目内容：<input type="text" name="coent" class="coent"></li>
									<li style="margin-left: 27px;" class="ljxone" >
										任务：<select   style="width: 159.43px;height: 25.06px;" name="t" class = "t">
											<option v-for="(te,index) in telist" v-bind:value ="te.id">{{te.name}}</option>
										</select>
									</li>
									<li style="margin-left: 27px;" class="ljxone" >
										年级：<select  v-model="name" style="width: 159.43px;height: 25.06px;" name="ljxclass" class = "ljxclasss">
											<option v-for="(g,index) in listgrade" v-bind:value ="g.id">{{g.name}}</option>
										</select>
									</li>
									<li style="margin-left: 27px;" class="ljxone btn-group" data-toggle="buttons">
									<label class="btn btn-primary" data-name="teaName" v-for="(tea,index) in listteacher" v-on:click="on(index)" ><input type="checkbox" class = "cl" v-bind:value="tea.id">{{tea.name}}</label>
										<!-- 班级：<select style="width: 159.43px;height: 25.06px;" name="ljxclasses" id="at">
											<option  v-bind:value ="tea.name">{{tea.name}}</option>
										</select> -->
									</li>
									<!-- 选择多个班级发布任务  
									<li>
										 <div> 
											 	at1716<input type="checkbox" checked="tuer">
										 		at1716<input type="checkbox" checked="tuer">
										 </div>
									</li>-->
									<li class="ljxone" >定时发布：<input type="datetime-local" name="name1" class = "name1">（填写之后会在规定的时间发布）</li>
									<li class="ljxone" >开始时间：<input type="datetime-local" name="ljxdate" class = "ljxdate"></li>
									<li class="ljxone" >结束时间：<input type="datetime-local" name="ljxtime" class = "ljxtime"></li>
								</ul>
						</div>
						
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
							<button type="submit" class="btn btn-primary">发布任务</button>
							<button type="button" v-on:click="fabu()">nnn</button>
						</div>
						</div>
					</div>
					</div>
			        </form>
			        
			        
			        <!-- Modal -->
					<div class="modal fade" id="mytui" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
					<div class="modal-dialog" role="document" style="width:500px;" v-for="(s,index) in xianglist">
						<div class="modal-content" v-for="(cp,index) in s.cpslist">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<h4 class="modal-title" id="myModalLabel">推迟任务</h4>
							学员姓名：<span>{{cp.studentname}}</span>
						</div>
						<div class="modal-body" v-for="(t,index) in s.stulist">
								<ul style="list-style: none; margin-left: 50px">
									<li class="ljxone">项目标题：<input type="text" name="ljxtitle" v-bind:value="t.ljxtitle"></li>
									<li class="ljxone"><span>推迟理由：</span><textarea rows="" cols="" style="width:180px;height:100px;">{{s.ljxcontent}}</textarea> </li>
									<li class="ljxone">发布时间：<input type="text" name="ljxtitle" v-bind:value="t.ljxdate"></li>
									<li class="ljxone">推迟时间：<input type="text" name="ljxtitle" v-bind:value="s.ljxTitme"></li>
								</ul>
								
							<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal" v-on:click="examine2(s.ljxtuid,s.ljxuid)">Close</button>
							<button type="button" class="btn btn-primary" v-on:click="examine(s.ljxtuid,s.ljxuid)">同意推迟</button>
							</div>
						</div>
						
						
						</div>
					</div>
					</div>
        		</div>
        		<!-- End .outlet -->
        	</div>
        	<!-- End .content-wrapper -->
        	<div class="clearfix"></div>
        </div>
		
		
		
        <!-- End #content -->
        <!-- Javascripts -->
        <!-- Load pace first -->
        <script src="assets/plugins/core/pace/pace.min.js"></script>
        <!-- Important javascript libs(put in all pages) -->
        <script src="assets/js/jquery-1.8.3.min.js"></script>
        <script src="assets/js/jquery-ui.js"></script>
        <script>
        window.jQuery || document.write('<script src="assets/js/libs/jquery-ui-1.10.4.min.js">\x3C/script>')
        </script>
        <!--[if lt IE 9]>
  <script type="text/javascript" src="assets/js/libs/excanvas.min.js"></script>
  <script type="text/javascript" src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <script type="text/javascript" src="assets/js/libs/respond.min.js"></script>
<![endif]-->
        <!-- Bootstrap plugins -->
        <script src="assets/js/bootstrap/bootstrap.js"></script>
        <!-- Core plugins ( not remove ever) -->
        <!-- Handle responsive view functions -->
        <script src="assets/js/jRespond.min.js"></script>
        <!-- Custom scroll for sidebars,tables and etc. -->
        <script src="assets/plugins/core/slimscroll/jquery.slimscroll.min.js"></script>
        <script src="assets/plugins/core/slimscroll/jquery.slimscroll.horizontal.min.js"></script>
        <!-- Resize text area in most pages -->
        <script src="assets/plugins/forms/autosize/jquery.autosize.js"></script>
        <!-- Proivde quick search for many widgets -->
        <script src="assets/plugins/core/quicksearch/jquery.quicksearch.js"></script>
        <!-- Bootbox confirm dialog for reset postion on panels -->
        <script src="assets/plugins/ui/bootbox/bootbox.js"></script>
        <!-- Other plugins ( load only nessesary plugins for every page) -->
        <script src="assets/plugins/charts/flot/date.js"></script>
        <script src="assets/plugins/charts/sparklines/jquery.sparkline.js"></script>
        <script src="assets/plugins/charts/pie-chart/jquery.easy-pie-chart.js"></script>
        <script src="assets/plugins/forms/icheck/jquery.icheck.js"></script>
        <script src="assets/plugins/forms/tags/jquery.tagsinput.min.js"></script>
        <script src="assets/plugins/forms/tinymce/tinymce.min.js"></script>
        <script src="assets/plugins/misc/highlight/highlight.pack.js"></script>
        <script src="assets/plugins/misc/countTo/jquery.countTo.js"></script>
        <script src="assets/plugins/ui/weather/skyicons.js"></script>
        <script src="assets/plugins/ui/notify/jquery.gritter.js"></script>
        <script src="assets/plugins/ui/calendar/fullcalendar.js"></script>
        <script src="assets/js/jquery.sprFlat.js"></script>
        <script src="assets/js/app.js"></script>
        <!-- <script src="assets/js/pages/dashboard.js"></script> -->
        <script src="assets/js/vue.js" type="text/javascript" charset="utf-8"></script>
        <script type="text/javascript" src="js/bootstrap/bootstrap.min.js"></script>
        <script type="text/javascript"> 
        	$(function(){
        		var v = new Vue({
					el:"#b",
					data:{
						list:null,
						listgrade:null,
						listteacher:null,
						cpsudentlist:null,
						name:null,
						yesno:0,//历史任务统计
						listyn:null,
						tuichiquery:null,//推迟任务
						xianglist:null,//推迟任务的详细信息
						typelist:null,//任务类型
						tealist:Array(),
						mo:null,
						telist:null
					},
					methods:{
						tuiClick:function(i){
							$(".see:eq("+i+")").next().toggle();
						},
						cpstudent1:function(claname){
							var yesno = "是";
							yes(claname,yesno);
						},
						cpstudent2:function(claname){
							var yesno = "否";
							yes(claname,yesno);
						},
						cpstudent4:function(claname){
							lishiquery(claname);
						},
						cpstudent3:function(claname){
							tuichiqueryS(claname);
						},
						tuix:function(ljxTuid){
							ljxTuidx(ljxTuid);
						},
						examine:function(ljxTuid,ljxUid){
							//alert(ljxTuid+">>>>>>examine>>>>"+ljxUid);
							e(ljxTuid,ljxUid);
						},
						examine2:function(ljxTuid,ljxUid){
							eE(ljxTuid,ljxUid);
						},
						fabu:function(){
							
							fabu();
						},
						on:function(i){
							var checked = $('label[data-name="teaName"]').eq(i).find('[class="icheckbox_flat-blue checked"]');//得到radio控件
							if(checked.length==0) {			
								$('label[data-name="teaName"]').eq(i).find("div").addClass("checked");
								this.tealist.push(i);
							}else{
								$('label[data-name="teaName"]').eq(i).find("div").removeClass("checked");
								var index = this.tealist.indexOf(i);
								this.tealist.splice(index,1);
								/* $.each(this.tealist, function(i,o){
									var text = $('label[data-name="teaName"]').eq(o).text();
									alert(text);
								}) */
							}
						}
					},watch:{
						name:function(){
							queryteacher(this.name);
						},
						mo:function(){
							soff(this.mo);
						}
					}
				});
			$.ajax({
				url:"/teacher_history",
				type:"post",
				success:function(date){
					//alert(JSON.stringify(date))
					v.list = date;
				}
			})  
			
			$.ajax({
				url:"querygrade",
				type:"post",
				success:function(date){
					v.listgrade = date;
				}
			})
			
			function yes(name,yesno){
				//完成任务的学生
				$.ajax({
					url:"/cpstudent",
					data:"name="+name+"&yesno="+yesno,
					type:"post",
					success:function(date){
						//alert(JSON.stringify(date))
						v.cpsudentlist = date;
						v.yesno=0;
					}
				})
			}
			
			function queryteacher(grade){
				//alert(grade+"grade");
				$.ajax({
					url:"/queryclazz",
					data:"gradeid="+grade,
					type:"post",
					success:function(date){
						v.listteacher = date;
					}
				})
			}
			
			//任务历史
			function lishiquery(claname){
				$.ajax({
					url:"/studentnyj",
					data:"ljxTname="+claname,
					type:"post",
					success:function(date){
						console.log(date);
						v.listyn = date;
						v.yesno = 1;
					},error:function(){
						console.log("error");
					}
				})
			}
			
			//tuichi
			function tuichiqueryS(ljxclaname){
				//alert("tuichi");
				$.ajax({
					url:"/tuichiquery",
					data:"ljxclaname="+ljxclaname,
					type:"post",
					success:function(date){
						//alert(JSON.stringify(date));
						v.tuichiquery = date;
						v.yesno = 2;
					}
				})
			}
			
			//ljxTuid
			function ljxTuidx(ljxTuid){
				$.ajax({
					url:"/xiangx",
					data:"ljxTuid="+ljxTuid,
					type:"post",
					success:function(date){
						//alert(JSON.stringify(date));
						v.xianglist = date;
					}
				})
			}
			
			//通过审核
			function e(tid,uid){
				var yesno = "是";
				$.ajax({
					url:"/einsert",
					data:"tuid="+tid+"&uid="+uid+"&yesno="+yesno,
					type:"post",
					success:function(date){
						
					}
				})
			}
			
			//未通过审核
			function eE(tid,uid){
        		var yesno = "否";
				$.ajax({
					url:"/einsert",
					data:"tuid="+tid+"&uid="+uid+"&yesno="+yesno,
					type:"post",
					success:function(date){
						
					}
				})
			}
			
			//任务类型
			$.ajax({
					url:"/query",
					data:"",
					type:"post",
					success:function(date){
						v.typelist = date
					}
				})
				
				//发布任务修改
				function fabu(){
				var title = $(".ljxtitle").val();
				var coent = $(".coent").val();
				var ljxclasss = $(".ljxclasss").text();
				var name1 = $(".name1").val();
				var ljxdate = $(".ljxdate").val();
				var ljxtime = $(".ljxtime").val();
				var t = $(".t").val();
				var type = $("#type").val();
				alert(t);
				var text = "";
				var dan = ",";
				$.each(v.tealist, function(i,o){
					text += $('label[data-name="teaName"]').eq(o).text()+",";
					dan += $(".cl:eq("+o+")").val()+",";
				}) 
				alert(dan);
				
				$.ajax({
					url:"/stuinsert",
					data:"ljxtitle="+title+"&ljxclass=S2&name1="+name1+"&ljxdate="+ljxdate+"&ljxtime="+ljxtime+"&at="+text+"&cl="+dan,
					type:"post",
					success:function(date){
						
					}
				})
			}
			
			
			//soff
			function soff(name2){
				$.ajax({
					url:"/queryfabu",
					data:"name2="+name2,
					type:"post",
					success:function(date){
						alert(JSON.stringify(date))
						v.telist = date;
					}
				})
			}
        	})
        	
        	
        	
        	
        </script>
    </body>
</html>
